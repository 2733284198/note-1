## 记一次go内存调优

- 现象：一个go写的服务，有1G的缓存数据，这部分的数据只有关闭服务才会释放，刚启动服务的时候通过top命令，显示使用1G内存，之后逐渐涨到2G多才稳定下来。

- 原因： 跟Go的GC机制有关。go有个环境变量GOGC，默认是100，意思是每次GC之后，下一次触发GC的条件为：当内存使用量达到上一次GC内存的100%。所以上面的例子中GC之后缓存中的内存没有释放，下次触发GC的条件是内存达到2G时。

- 解决办法： 在程序中通过debug.SetGCPercent()来修改这个值。比如改成50，那么服务使用的内存将在1.5G左右稳定下来。go的GC机制对于有缓存的服务是个大坑。
